<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Proyecto Grua HNG</title>
    <!-- Favicon del icono de la página -->
    <link
      rel="shortcut icon"
      href="./resources/favicon.ico"
      type="image/x-icon"
    />

    <!-- Bootstrap CSS -->
    <link
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Vue -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    
    <!-- jQuery and Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

    <script src="js/utiles.js" defer></script>

  </head>
  <body>
    <div class="container" id="app">
      <!-- No logeado -->
      <div v-if="!logeado" class="d-flex justify-content-center align-items-center vh-100">
        <div class="card p-4 shadow-lg" style="width: 30rem; border-radius: 15px;">
          <div class="card-body text-center">
            <!-- Título -->
            <h1 class="card-title mb-4">GRUA MUNICIPAL</h1>
            <p class="card-text text-muted mb-4">Inicia sesión para continuar</p>
              <!-- Campo de Email -->
              <div class="mb-3">
                <label for="email" class="form-label">Email:</label>
                <input
                  type="text"
                  class="form-control form-control-lg"
                  v-model="email"
                  name="email"
                  id="email"
                  placeholder="Ingresa tu email"
                />
              </div>
      
              <!-- Campo de Contraseña -->
              <div class="mb-3">
                <label for="contrasena" class="form-label">Contraseña:</label>
                <input
                  type="password"
                  class="form-control form-control-lg"
                  v-model="contrasena"
                  name="contrasena"
                  id="contrasena"
                  placeholder="Ingresa tu contraseña"
                />
              </div>
      
              <!-- Botón de Inicio de Sesión -->
              <button type="button" @click="intentoLogin" class="btn btn-primary btn-lg w-100 mt-4">
                Iniciar Sesión
              </button>
            </p>
          </div>
        </div>
      </div>
      <!-- Logueado -->
      <div v-else>
        <div>
          <header>
            <p class="bg">Panel Administración Grua Municipal {{usuario.email}}</p>
          </header>
          <nav>
            <ul>
              <!-- Registro con todas las acciones y listar solo con el listado para el admin -->
              <li><button type="button" @click="mostrarLiquidacion">Liquidaciones</button></li>
              <li v-if="isAdmin()"><button type="button" @click="mostrarRetirada">Retiradas</button></li>
              <li v-if="isAdmin()"><button type="button" @click="mostrarUsuarios">Gestión Usuarios</button></li>
            </ul>
          </nav>
          <section>
            <!-- Registrar la entrega de un vehiculo (admin) -->
            <div v-if="pantalla === 'liquidacion'"></div>

            <!-- Retirada de vehiculo por grua (admin y operario) -->
            <div v-if="pantalla === 'retiradas'">
              <h1>Gestión de retiradas de vehículos por grúa</h1>
              <!-- Botón para abrir el modal -->
              <button class="btn btn-primary mt-3" data-toggle="modal" data-target="#retiradaCrearModal">
                Agregar Vehículo
              </button>

              <!-- Tabla para mostrar las retiradas -->
              <table class="table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Fecha de entrada</th>
                    <th>Fecha de salida</th>
                    <th>Lugar</th>
                    <th>Dirección</th>
                    <th>Agente</th>
                    <th>Matrícula</th>
                    <th>Marca</th>
                    <th>Modelo</th>
                    <th>Color</th>
                    <th>Motivo</th>
                    <th>Tipo Vehículo</th>
                    <th>Grúa</th>
                    <th>Estado</th>
                    <th>Fecha</th>
                    <th>Editar</th>
                    <th>Eliminar</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="retirada in retiradas">
                    <td>{{ retirada.id }}</td>
                    <td>{{ retirada.fecha_entrada }}</td>
                    <td>{{ retirada.fecha_salida }}</td>
                    <td>{{ retirada.lugar }}</td>
                    <td>{{ retirada.direccion }}</td>
                    <td>{{ retirada.agente }}</td>
                    <td>{{ retirada.matricula }}</td>
                    <td>{{ retirada.marca }}</td>
                    <td>{{ retirada.modelo }}</td>
                    <td>{{ retirada.color }}</td>
                    <td>{{ retirada.motivo }}</td>
                    <td>{{ retirada.tipo_vehiculo }}</td>
                    <td>{{ retirada.grua }}</td>
                    <td>{{ retirada.estado }}</td>
                    <td>{{ retirada.fecha }}</td>
                    <td><button @click="formularioEditarRetirada(retirada.id)" class="btn btn-warning" data-toggle="modal" data-target="#retiradaEditarModal">Editar retirada</button></td>
                    <td><button @click="formularioEliminarRetirada(retirada.id)" class="btn btn-danger" data-toggle="modal" data-target="#retiradaEliminarModal">Eliminar retirada</button></td>
                  </tr>
                </tbody>
              </table>
              
              <!-- Crear retirada -->
              <div class="modal fade" id="retiradaCrearModal" tabindex="-1" role="dialog" aria-labelledby="retiradaCrearModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="retiradaCrearModalLabel">Creación de usuario</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                          <div class="row">
                            <div class="col-md-12 mb-6">
                              <label for="id" class="form-label">ID:</label>
                              <input type="text" v-model="formRetirada.id" class="form-control" id="id" required>
                            </div>
                            <div class="col-md-12 mb-6">
                              <label for="fecha_entrada" class="form-label">Fecha de Entrada:</label>
                              <input type="datetime-local" v-model="formRetirada.fecha_entrada" class="form-control" id="fecha_entrada" required>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-12 mb-6">
                              <label for="fecha_salida" class="form-label">Fecha de Salida:</label>
                              <input type="datetime-local" v-model="formRetirada.fecha_salida" class="form-control" id="fecha_salida">
                            </div>
                            <div class="col-md-12 mb-6">
                              <label for="lugar" class="form-label">Lugar:</label>
                              <input type="text" v-model="formRetirada.lugar" class="form-control" id="lugar" required>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-12 mb-6">
                              <label for="direccion" class="form-label">Dirección:</label>
                              <input type="text" v-model="formRetirada.direccion" class="form-control" id="direccion" required>
                            </div>
                            <div class="col-md-12 mb-6">
                              <label for="agente" class="form-label">Agente:</label>
                              <input type="text" v-model="formRetirada.agente" class="form-control" id="agente" required>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-12 mb-6">
                              <label for="matricula" class="form-label">Matrícula:</label>
                              <input type="text" v-model="formRetirada.matricula" class="form-control" id="matricula" required>
                            </div>
                            <div class="col-md-12 mb-6">
                              <label for="marca" class="form-label">Marca:</label>
                              <input type="text" v-model="formRetirada.marca" class="form-control" id="marca" required>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-12 mb-6">
                              <label for="modelo" class="form-label">Modelo:</label>
                              <input type="text" v-model="formRetirada.modelo" class="form-control" id="modelo" required>
                            </div>
                            <div class="col-md-12 mb-6">
                              <label for="color" class="form-label">Color:</label>
                              <input type="text" v-model="formRetirada.color" class="form-control" id="color" required>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-12 mb-6">
                              <label for="motivo" class="form-label">Motivo:</label>
                              <input type="text" v-model="formRetirada.motivo" class="form-control" id="motivo" required>
                            </div>
                            <div class="col-md-12 mb-6">
                              <label for="tipo_vehiculo" class="form-label">Tipo de Vehículo:</label>
                              <select id="" v-model="formRetirada.tipo_vehiculo" class="form-control"  id="tipo_vehiculo" required>
                                <option value="Motocicleta, aperos, motocarros y similares">Motocicleta, aperos, motocarros y similares</option>
                                <option value="Turismo hasta 12 cv o Remolques hasta 750 kg">Turismo hasta 12 cv o Remolques hasta 750 kg</option>
                                <option value="Turismos más de 12 cv o Remolques más de 750 kg">Turismos más de 12 cv o Remolques más de 750 kg</option>
                                <option value="Vehiculos especiales">Vehículos especiales</option>
                                <option value="Vehiculos de cortesia">Vehiculos de cortesia</option>
                                <option value="Chatarra">Chatarra</option>
                              </select>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-12 mb-6">
                              <label for="grua" class="form-label">Grúa:</label>
                              <select id="" v-model="formRetirada.grua" class="form-control"  id="grua" required>
                                <option value="Grua Este">Grua Este</option>
                                <option value="Grua Norte">Grua Norte</option>
                                <option value="Grua Ajandemol">Grua Ajandemol</option>
                                <option value="Grua Omega">Grua Omega</option>
                                <option value="Grua Sigma">Grua Sigma</option>
                              </select>
                            </div>
                            <div class="col-md-12 mb-6">
                              <label for="estado" class="form-label">Estado:</label>
                              <select v-model="formRetirada.estado" class="form-control" id="estado" readonly>
                              <option value="En deposito">En deposito</option>
                              <option value="Liquidado">Liquidado</option>
                              </select>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-12 mb-6">
                              <label for="fecha" class="form-label">Fecha:</label>
                              <input type="datetime-local" v-model="formRetirada.fecha" class="form-control" id="fecha" required>
                            </div>
                          </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                            <button type="button" class="btn btn-primary" @click="crearRetirada">Crear retirada</button>
                        </div>
                    </div>
                </div>
              </div>

              <!-- Eliminar retirada -->
              <div class="modal fade" id="retiradaEliminarModal" tabindex="-1" role="dialog" aria-labelledby="retiradaEliminarModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="retiradaEliminarModalLabel">Eliminación de retirada</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                          <div class="row">
                            <div class="col-md-12 mb-6">
                              <h5>¿Estás seguro de que quieres eliminar la retirada Nº{{retirada_seleccionada.id}}?</h5>
                            </div>
                          </div>
                      </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                            <button type="button" class="btn btn-danger" @click="eliminarRetirada">Eliminar retirada</button>
                        </div>
                    </div>
                </div>
              </div>

              <!-- Editar retirada -->
              <div class="modal fade" id="retiradaEditarModal" tabindex="-1" role="dialog" aria-labelledby="retiradaEditarModal" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="retiradaEditarModal">Modificación de retirada</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                          <div class="row">
                            <div class="col-md-12 mb-6">
                              <label for="id" class="form-label">ID:</label>
                              <input type="text" v-model="retirada_seleccionada.id" class="form-control" id="id" required>
                            </div>
                            <div class="col-md-12 mb-6">
                              <label for="fecha_entrada" class="form-label">Fecha de Entrada:</label>
                              <input type="datetime-local" v-model="retirada_seleccionada.fecha_entrada" class="form-control" id="fecha_entrada" required>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-12 mb-6">
                              <label for="fecha_salida" class="form-label">Fecha de Salida:</label>
                              <input type="datetime-local" v-model="retirada_seleccionada.fecha_salida" class="form-control" id="fecha_salida">
                            </div>
                            <div class="col-md-12 mb-6">
                              <label for="lugar" class="form-label">Lugar:</label>
                              <input type="text" v-model="retirada_seleccionada.lugar" class="form-control" id="lugar" required>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-12 mb-6">
                              <label for="direccion" class="form-label">Dirección:</label>
                              <input type="text" v-model="retirada_seleccionada.direccion" class="form-control" id="direccion" required>
                            </div>
                            <div class="col-md-12 mb-6">
                              <label for="agente" class="form-label">Agente:</label>
                              <input type="text" v-model="retirada_seleccionada.agente" class="form-control" id="agente" required>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-12 mb-6">
                              <label for="matricula" class="form-label">Matrícula:</label>
                              <input type="text" v-model="retirada_seleccionada.matricula" class="form-control" id="matricula" required>
                            </div>
                            <div class="col-md-12 mb-6">
                              <label for="marca" class="form-label">Marca:</label>
                              <input type="text" v-model="retirada_seleccionada.marca" class="form-control" id="marca" required>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-12 mb-6">
                              <label for="modelo" class="form-label">Modelo:</label>
                              <input type="text" v-model="retirada_seleccionada.modelo" class="form-control" id="modelo" required>
                            </div>
                            <div class="col-md-12 mb-6">
                              <label for="color" class="form-label">Color:</label>
                              <input type="text" v-model="retirada_seleccionada.color" class="form-control" id="color" required>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-12 mb-6">
                              <label for="motivo" class="form-label">Motivo:</label>
                              <input type="text" v-model="retirada_seleccionada.motivo" class="form-control" id="motivo" required>
                            </div>
                            <div class="col-md-12 mb-6">
                              <label for="tipo_vehiculo" class="form-label">Tipo de Vehículo:</label>
                              <select id="" v-model="retirada_seleccionada.tipo_vehiculo" class="form-control"  id="tipo_vehiculo" required>
                                <option value="Motocicleta, aperos, motocarros y similares">Motocicleta, aperos, motocarros y similares</option>
                                <option value="Turismo hasta 12 cv o Remolques hasta 750 kg">Turismo hasta 12 cv o Remolques hasta 750 kg</option>
                                <option value="Turismos más de 12 cv o Remolques más de 750 kg">Turismos más de 12 cv o Remolques más de 750 kg</option>
                                <option value="Vehiculos especiales">Vehículos especiales</option>
                                <option value="Vehiculos de cortesia">Vehiculos de cortesia</option>
                                <option value="Chatarra">Chatarra</option>
                              </select>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-12 mb-6">
                              <label for="grua" class="form-label">Grúa:</label>
                              <select id="" v-model="retirada_seleccionada.grua" class="form-control"  id="grua" required>
                                <option value="Grua Este" :selected="retirada_seleccionada.grua === 'Grua Este'">Grua Este</option>
                                <option value="Grua Norte" :selected="retirada_seleccionada.grua === 'Grua Norte'">Grua Norte</option>
                                <option value="Grua Ajandemol" :selected="retirada_seleccionada.grua === 'Grua Ajandemol'">Grua Ajandemol</option>
                                <option value="Grua Omega" :selected="retirada_seleccionada.grua === 'Grua Omega'">Grua Omega</option>
                                <option value="Grua Sigma" :selected="retirada_seleccionada.grua === 'Grua Sigma'">Grua Sigma</option>
                              </select>
                            </div>
                            <div class="col-md-12 mb-6">
                              <label for="estado" class="form-label">Estado:</label>
                              <select v-model="retirada_seleccionada.estado" class="form-control" id="estado" readonly>
                              <option value="En deposito">En deposito</option>
                              <option value="Liquidado">Liquidado</option>
                              </select>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-12 mb-6">
                              <label for="fecha" class="form-label">Fecha:</label>
                              <input type="datetime-local" v-model="retirada_seleccionada.fecha" class="form-control" id="fecha" required>
                            </div>
                          </div>
                        </div>
                      <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                          <button type="button" class="btn btn-warning" @click="editarRetirada">Editar retirada</button>
                      </div>
                    </div>
                </div>
              </div>
            </div>

            <!-- Gestión de usuarios (admin) -->
            <div v-if="pantalla === 'usuarios'">
              <h1>Gestión de usuarios</h1>
              <h3><button @click="formularioCrearUsuario" data-toggle="modal" data-target="#createModal">Crear usuario</button></h3>
              <!-- Tabla usuarios -->
              <table class="table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Email</th>
                    <th>Contraseña</th>
                    <th>Rol</th>
                    <th>Editar</th>
                    <th>Eliminar</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="usuario in usuarios">
                    <td>{{ usuario.id }}</td>
                    <td>{{ usuario.email }}</td>
                    <td>{{ usuario.password }}</td>
                    <td>
                      <span :class="{'text-danger': usuario.rol === 'administrador', 'text-secondary': usuario.rol === 'operario'}">
                      {{ usuario.rol === 'administrador' ? 'Administrador' : 'Operario' }}
                      </span>
                    </td>
                    <td>
                      <button @click="formularioEditarUsuario(usuario.id)" class="btn btn-primary" data-toggle="modal" data-target="#editModal">Editar usuario</button></td>
                    <td>
                      <button @click="formularioEliminarUsuario(usuario.id)" class="btn btn-danger" data-toggle="modal" data-target="#deleteModal">Eliminar usuario</button>
                    </td>
                  </tr>
                </tbody>
              </table>

              <!-- Modal crear usuario -->
              <div class="modal fade" id="createModal" tabindex="-1" role="dialog" aria-labelledby="createModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="createModalLabel">Creación de usuario</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <label for="email">Email:</label>
                            <input type="text" class="form-control" v-model="email" />
                            <label for="password">Contraseña:</label>
                            <input type="text" class="form-control" v-model="contrasena" />
                            <label for="rol">Rol:</label>
                            <select class="form-control" v-model="rol">
                                <option value="administrador">Administrador</option>
                                <option value="usuario">Usuario</option>
                            </select>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                            <button type="button" class="btn btn-primary" @click="crearUsuario">Crear usuario</button>
                        </div>
                    </div>
                </div>
              </div>
  
              <!-- Modal editar usuario -->
              <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="editModalLabel">Edición del usuario {{ usuario_seleccionado.email }}</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <label for="email">Email:</label>
                      <input type="text" class="form-control" v-model="usuario_seleccionado.email" />
                      <label for="password">Contraseña:</label>
                      <input type="text" class="form-control" v-model="usuario_seleccionado.password" />
                      <label for="rol">Rol:</label>
                      <select class="form-control" v-model="usuario_seleccionado.rol">
                        <option value="administrador">Administrador</option>
                        <option value="usuario">Usuario</option>
                      </select>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                      <button type="button" class="btn btn-primary" @click="editarUsuario">Guardar cambios</button>
                    </div>
                  </div>
                </div>
              </div>
  
              <!-- Modal eliminar usuario -->
              <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="deleteModalLabel">Confirmar eliminación</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      ¿Está seguro de que desea eliminar al usuario {{  usuario_seleccionado.email }}?
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                      <button type="button" class="btn btn-danger" @click="eliminarUsuario">Eliminar</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>
          
          <footer class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2);">
              © 2023 Todos los derechos reservados:
              <a class="text-white" href="#">docarmoelmejor.com</a>
          </footer>
        </div>
      </div>
    </div>
  </body>
</html>

